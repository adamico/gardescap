%h2.text-center= "Choix des gardes " + @period.name

.row
  .col-lg-offset-4.col-lg-4
    %button.btn.btn-primary.btn-lg{data: {toggle: "modal", target: "#modeEmploi"}} Ouvrir le mode d'emploi

%br

- if current_user.admin?
  .row
    .col-lg-2
      %h3 Administration
    .col-lg-8
      .btn-group
        = link_to "Initialiser les gardes sur la période", populate_period_path(id: @period.id), class: "btn btn-success btn-lg"
        = link_to "Modifier ce tableau", edit_period_path(@period), class: "btn btn-lg btn-default"
      = form_for @period, html: {class: "form-inline state_machine", role: "form"} do |f|
        = f.hidden_field :state_event, value: f.object.state_transitions.first.event, class: "form-control"
        = f.submit t("activerecord.state_machines.period.events." + @period.state_transitions.first.event.to_s), class: "btn btn-info btn-lg"
  %br

- if @gardes.any?
  - cache @period do
    %ul.nav.nav-tabs
      - @mois.each_with_index do |mois, index|
        %li{class: index == 0 ? "active" : nil}
          %a{href: "##{mois}", data: {toggle: "tab"}} #{I18n.t("date.month_names")[mois]}

    .tab-content
      - @mois.each_with_index do |mois, index|
        - gardes = @mois_gardes[mois]
        .tab-pane{id: mois, class: index == 0 ? "active" : nil}
          %table.table.table-bordered.table-striped
            %thead
              %tr
                %th #{I18n.t("date.month_names")[mois]}
                %th{colspan: 2} Matin
                %th{colspan: 2} Après-midi
                %th Nuit courte
                %th Nuit longue
            - @period.days(mois).each do |date|
              %tr
                %th= l(date, format: :superlong)
                - Garde::TIMES.each do |time|
                  %td{id: [date, time].join("-")}
                    - cache (garde = @period.gardes.select {|g| g.date == date.to_date && g.time == time}.first) do
                      = render 'gardes/garde', time: time, date: date, garde: garde, period_id: @period.id

- else
  .row
    .col-lg-offset-4.col-lg-4
      %p Aucune garde saisie sur cette periode

.modal.fade#modeEmploi{tabindex: "-#", role: "dialog", aria: {labelledby: "modeEmploiModal", hidden: "true"}}
  .modal-dialog
    .modal-content
      .modal-header
        %button.close{type: "button", "data-dismiss" => "modal", "aria-hidden" => "true"} &times;
        %h4.modal-title#modeEmploiModal Mode d'emploi
      .modal-body
        %p Choisissez le moi en clickant sur les noms des mois en haut de la table.
        %p Pour vous positionner sur une plage de garde, clickez sur 'Personne' si celle-ci est encore vide ou sur la liste des noms déjà présent.
        .alert.alert-warning
          %strong Attention ! Chaque plage peut contenir maximum 3 noms. Vous pouvez en principe effacer votre nom et tous les autres qui sont déjà rentrés dans une plage, mais veuillez prévenir la personne en question pour voir si elle est d'accord. Les plages complètes feront de toute façon l'object d'une discussion le jour du choix des gardes.
        %p Si vous avez clické sur une plage vide vous pouvez simplement rentrer votre nom après avoir clické sur la phrase 'saisir votre nom ici' ; si vous avez clické sur la liste des noms et si celle-ci comporte moins de 3 éléments clickez à coté de la dernière pastille avec un nom et rentrez le votre.
        %p
          Dans tous les cas, une fois votre nom rentré dans le champ appuyez sur le bouton
          %button.btn.btn-primary.btn-sm.disabled
            %span.glyphicon.glyphicon-ok
          pour valider la modification ou sur le bouton
          %button.btn.btn-default.btn-sm.disabled
            %span.glyphicon.glyphicon-remove
          pour abandonner vos modifications.
      .modal-footer
        %button.btn.btn-default{type: "button", "data-dismiss" => "modal"} Fermer

